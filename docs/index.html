<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal Paste Service</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Testing: Open in browser, toggle Theme button (colors switch and persist after reload), paste long text and confirm it scrolls inside textarea without page scrolling, resize browser and confirm layout works on mobile -->
    <header class="page-header">
        <h1 class="header-title">Minimal Paste Service</h1>
        <div class="header-actions">
            <button id="infoButton" class="info-button" aria-label="Info about project"><i>i</i></button>
            <a href="history.html" class="header-link">History</a>
            <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme" aria-pressed="false">Theme</button>
        </div>
    </header>
    
    <main class="editorContainer">
        <form id="paste-form" method="POST" action="create">
            <textarea id="pasteInput" name="text" placeholder="Paste your text here..." autofocus></textarea>
        </form>
        <div class="button-container">
            <button id="goButton" class="btn-primary" type="submit" form="paste-form">Go</button>
        </div>
    </main>

    <script src="app.js"></script>
    <script>
        const textarea = document.getElementById('pasteInput');
        const form = document.getElementById('paste-form');
        const goButton = document.getElementById('goButton');

        // Handle form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const content = textarea.value.trim();
            
            if (!content) {
                alert('Please enter some text');
                return;
            }
            
            goButton.disabled = true;
            goButton.textContent = 'Creating...';
            
            try {
                const response = await fetch(`${BASE_URL}/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: 'text=' + encodeURIComponent(content),
                    redirect: 'manual'
                });
                
                if (response.type === 'opaqueredirect' || response.status === 303 || response.status === 0) {
                    // CORS prevents reading Location header, fetch history to get latest paste
                    const historyResponse = await fetch(`${BASE_URL}/api/history`);
                    if (historyResponse.ok) {
                        const history = await historyResponse.json();
                        if (history && history.length > 0) {
                            const latestPaste = history[history.length - 1];
                            window.location.href = `view.html?${latestPaste.id}`;
                            return;
                        }
                    }
                    throw new Error('Could not find created paste');
                } else if (response.ok) {
                    const text = await response.text();
                    alert('Paste created successfully!');
                    textarea.value = '';
                    goButton.disabled = false;
                    goButton.textContent = 'Go';
                } else {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                }
            } catch (error) {
                console.error('Error creating paste:', error);
                alert('Failed to create paste: ' + error.message);
                goButton.disabled = false;
                goButton.textContent = 'Go';
            }
        });

        // Allow Ctrl+Enter to submit
        textarea.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                form.dispatchEvent(new Event('submit'));
            }
        });
    </script>
</body>
</html>
